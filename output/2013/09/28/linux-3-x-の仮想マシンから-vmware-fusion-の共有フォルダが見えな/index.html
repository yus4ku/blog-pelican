<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="author" content="Yusaku" />
        <meta name="copyright" content="Yusaku" />
        
                <meta name="keywords" content="Debian, Linux, " />
        <title>Linux 3.x の仮想マシンから VMware Fusion の共有フォルダが見えない  · いままでのこと
</title>
                <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://blog.tekito.org/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://blog.tekito.org/theme/css/solarizedlight.css" media="screen">
                <link rel="shortcut icon" href="http://blog.tekito.org/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://blog.tekito.org/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://blog.tekito.org/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://blog.tekito.org/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://blog.tekito.org/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://blog.tekito.org/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://blog.tekito.org/theme/images/apple-touch-icon-144x144.png" />
                <link href="http://blog.tekito.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="いままでのこと - Full Atom Feed" />
            <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12673985-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://blog.tekito.org/"><span class=site-name>いままでのこと</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://blog.tekito.org">Home</a></li>
                                                                                    <li ><a href="http://blog.tekito.org/pages/about.html">About</a></li>
                                                                                    <li ><a href="http://blog.tekito.org/categories.html">Categories</a></li>
                            <li ><a href="http://blog.tekito.org/tags.html">Tags</a></li>
                            <li ><a href="http://blog.tekito.org/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://blog.tekito.org/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
                    <article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://blog.tekito.org/2013/09/28/linux-3-x-の仮想マシンから-vmware-fusion-の共有フォルダが見えな/"> Linux 3.x の仮想マシンから VMware Fusion の共有フォルダが見えない  </a></h1>
    </header>
</div>

<div class="row-fluid">
            <div class="span8 offset2 article-content">
            
            <p>VMware Fusion 上の Linux 仮想マシンから Mac の共有フォルダが見えなくなることが、たびたび (Linux カーネルをアップデートするたび？) あります。</p>
<div class="highlight"><pre>$ ls /mnt/hgfs/
(見えない...。)
</pre></div>
<p>どうも <em>vmhgfs</em> (VMware Host-Guest File System) というカーネルモジュールがロードされていないことが原因らしい。</p>
<div class="highlight"><pre>$ lsmod | grep vmhgfs
(ロードされてない...。)
</pre></div>
<p>いままでこうなったときは VMware Tools を再インストールして修復していました。しかし、VMware Tools は Linux 3.x に対応していないのか、モジュールのビルドに失敗するなど、色々とおかしくなっており、今回は VMware Tools を再インストールしても問題は解消せず。仕方なく手で直しました。</p>
<p><strong>とりえあず共有フォルダが使えるようになるところまでです。この記事は参考程度に、修復の実施は自己責任でお願いします。</strong></p>
<div class="section" id="id1">
<h2>環境</h2>
<ul class="simple">
<li>VMware Fusion 5.03</li>
<li>ホスト: OS X 10.8.5 (Mountain Lion)</li>
<li>ゲスト: Linux 3.10.11 (Debian GNU/Linux jessie amd-64)</li>
</ul>
</div>
<div class="section" id="id2">
<h2>そもそも</h2>
<p>試していませんが <em>open-vm-tools</em> を使うとすぐに解消できるかもしれません。</p>
</div>
<div class="section" id="id3">
<h2>はじめに</h2>
<p>まずは VMware Tools を再インストールしましょう。それで直れば解決です。</p>
<p>ぼくは VMware Tools 9.2.3 を使いました。</p>
<p>VMware Fusion のメニューから [仮想マシン] -&gt; [VMware Tools の再インストール] で Linux 側の /dev/cdrom に CD-ROM が入るので、それを適当にマウント、中にある tarball を展開、vmware-install.pl を実行すると再インストールできます。</p>
<p>再インストールしても修復できませんでしたので、手で直しました。</p>
</div>
<div class="section" id="initscript">
<h2>まず initscript の動作がおかしい</h2>
<p>Debian 特有の問題かもしれませんが、vmware-tools のサービスを立ち上げると以下のような出力があります。</p>
<div class="highlight"><pre># /etc/init.d/vmware-tools start
   Checking acpi hot plug                                              done
Starting VMware Tools services in the virtual machine:
   Switching to guest configuration:                                   done
/etc/init.d/vmware-tools: 1090: local: &#39;: bad variable name
/etc/init.d/vmware-tools: 1090: local: &#39;: bad variable name
   Blocking file system:                                              failed
/etc/init.d/vmware-tools: 1187: local: &#39;: bad variable name
   Guest operating system daemon:                                      done
</pre></div>
<p>原因は initscript 内の get_version_integer() 関数にあります。この関数で Linux カーネルのバージョンを取得するとき、uname -r した結果を使いますが、2.6.34 という風な 2 つ以上のピリオドで区切られた出力を期待しているため、動かないようです。実際に uname -r してみると、こんな感じ。</p>
<div class="highlight"><pre>$ uname -r
3.10-3-amd64
</pre></div>
<p>ぼくは区切り文字に - (ハイフン) を追加して適当に直しました。実際は Linux 3.10.11 を使っていますが、この修正方法だと 3.10.3 と誤認識されます。</p>
<div class="highlight"><pre><span class="gd">--- /etc/init.d/vmware-tools.orig</span>
<span class="gi">+++ /etc/init.d/vmware-tools</span>
<span class="gu">@@ -847,7 +847,7 @@</span>

   # There is no double quote around the back-quoted expression on purpose
   # There is no double quote around $version_uts on purpose
<span class="gd">-  set `IFS=&#39;.&#39;; echo $version_uts`</span>
<span class="gi">+  set `IFS=&#39;.-&#39;; echo $version_uts`</span>
   v1=&quot;$1&quot;
   v2=&quot;$2&quot;
   v3=&quot;$3&quot;
</pre></div>
<p>ちゃんとやるのであれば、uname の代わりに LINUX_VERSION_CODE から取得するのが正しそうです。(コマンドでサクッと取得できる方法があるとよいのですが、わからなかったです。)</p>
<div class="highlight"><pre><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;linux/version.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">LINUX_VERSION_CODE</span> <span class="o">&amp;</span> <span class="mh">0xFF0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span>
              <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">LINUX_VERSION_CODE</span> <span class="o">&amp;</span> <span class="mh">0x00FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span>
              <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">LINUX_VERSION_CODE</span> <span class="o">&amp;</span> <span class="mh">0x0000FF</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>修正すると、initscript の問題は解消されました。</p>
</div>
<div class="section" id="vmhgfs">
<h2>vmhgfs モジュールをビルドする</h2>
<p>VMware Tools の tarball の中にソースコードがあります。</p>
<div class="highlight"><pre>$ tar xzf VMwareTools-9.2.3-1031360.tar.gz
$ tar xf vmware-tools-distrib/lib/modules/source/vmhgfs.tar
$ cd vmhgfs-only
</pre></div>
<p>make すると以下のような出力があり、失敗します。</p>
<div class="highlight"><pre>$ make
Using 2.6.x kernel build system.
make -C /lib/modules/3.10-3-amd64/build/include/.. SUBDIRS=$PWD SRCROOT=$PWD/. \
          MODULEBUILDDIR= modules
make[1]: ディレクトリ `/usr/src/linux-headers-3.10-3-amd64&#39; に入ります
  CC [M]  /home/yu/work/vmware/vmhgfs-only/backdoor.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/backdoorGcc64.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/bdhandler.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/cpName.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/cpNameLinux.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/cpNameLite.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/dentry.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/dir.o
  CC [M]  /home/yu/work/vmware/vmhgfs-only/file.o
/home/yu/work/vmware/vmhgfs-only/file.c: In function ‘HgfsAioRead’:
/home/yu/work/vmware/vmhgfs-only/file.c:754:32: error: dereferencing pointer to incomplete type
/home/yu/work/vmware/vmhgfs-only/file.c: In function ‘HgfsAioWrite’:
/home/yu/work/vmware/vmhgfs-only/file.c:803:32: error: dereferencing pointer to incomplete type
make[4]: *** [/home/yu/work/vmware/vmhgfs-only/file.o] エラー 1
make[3]: *** [_module_/home/yu/work/vmware/vmhgfs-only] エラー 2
make[2]: *** [sub-make] エラー 2
make[1]: *** [all] エラー 2
make[1]: ディレクトリ `/usr/src/linux-headers-3.10-3-amd64&#39; から出ます
make: *** [vmhgfs.ko] エラー 2
</pre></div>
<p>初っ端に <em>Using 2.6.x kernel build system.</em> と出力されているあたりから、3.x に対応していないことが伺えます。</p>
<p>結局ぼくの環境では vmhgfs モジュールをビルドして動かすまでに <em>file.c</em>, <em>inode.c 周り</em>, <em>vmci.c 周り</em> を修正する必要がありました。</p>
<ol class="arabic">
<li><p class="first">file.c の修正</p>
<p>make すると以下のようなエラーが発生しました。</p>
<div class="highlight"><pre>/home/yu/work/vmware/vmhgfs-only/file.c: In function ‘HgfsAioRead’:
/home/yu/work/vmware/vmhgfs-only/file.c:754:32: error: dereferencing pointer to incomplete type
/home/yu/work/vmware/vmhgfs-only/file.c: In function ‘HgfsAioWrite’:
/home/yu/work/vmware/vmhgfs-only/file.c:803:32: error: dereferencing pointer to incomplete type
</pre></div>
<p>これは kiocb 構造体の宣言が見つからないことが原因のようです。宣言は linux/aio.h にありますので、それをインクルードすると解消されました。</p>
<p><a class="reference external" href="http://blog.tekito.org/static/data/2013/09/28/vmware-tools-9.2.3-file.patch">vmware-tools-9.2.3-file.patch</a></p>
<div class="highlight"><pre><span class="gd">--- a/file.c.orig</span>
<span class="gi">+++ b/file.c</span>
<span class="gu">@@ -25,6 +25,7 @@</span>
 /* Must come before any kernel header file. */
 #include &quot;driver-config.h&quot;

<span class="gi">+#include &lt;linux/aio.h&gt;</span>
 #include &lt;linux/errno.h&gt;
 #include &lt;linux/module.h&gt;
 #include &lt;linux/signal.h&gt;
</pre></div>
</li>
<li><p class="first">inode.c 周りの修正</p>
<p>make すると以下のようなエラーが発生しました。</p>
<div class="highlight"><pre>/home/yu/work/vmware/vmhgfs-only/inode.c: In function ‘HgfsTruncatePages’:
/home/yu/work/vmware/vmhgfs-only/inode.c:888:4: error: implicit declaration of function ‘vmtruncate’ [-Werror=implicit-function-declaration]
/home/yu/work/vmware/vmhgfs-only/inode.c: In function ‘HgfsPermission’:
/home/yu/work/vmware/vmhgfs-only/inode.c:1821:64: error: macro &quot;hlist_for_each_entry&quot; passed 4 arguments, but takes just 3
/home/yu/work/vmware/vmhgfs-only/inode.c:1821:7: error: ‘hlist_for_each_entry’ undeclared (first use in this function)
/home/yu/work/vmware/vmhgfs-only/inode.c:1821:7: note: each undeclared identifier is reported only once for each function it appears in
/home/yu/work/vmware/vmhgfs-only/inode.c:1821:66: error: expected ‘;’ before ‘{’ token
/home/yu/work/vmware/vmhgfs-only/inode.c:1815:11: warning: unused variable ‘dcount’ [-Wunused-variable]
/home/yu/work/vmware/vmhgfs-only/inode.c:1814:26: warning: unused variable ‘p’ [-Wunused-variable]
</pre></div>
<p>エラーの発生原因は 2 つあります。</p>
<p>ひとつは Linux 3.9 から hlist_for_each_entry マクロのインターフェースが変わったこと、もうひとつは Linux 3.8 から vmtruncate() 関数が廃止されたことです。</p>
<p>hlist_for_each_entry マクロはいまのインターフェースを参考に使い方を変更し、vmtruncate() 関数は元の実装を参考にマクロ定義しました。inode_operations 構造体が truncate を持たなくなったようなので、その辺りも考慮します。</p>
<ul class="simple">
<li><a class="reference external" href="http://lxr.free-electrons.com/source/include/linux/list.h?v=3.9#L674">Linux 3.9 の hlist_for_each_entry マクロ</a></li>
<li><a class="reference external" href="http://lxr.free-electrons.com/source/mm/truncate.c?v=3.7#L579">Linux 3.7 の vmtruncate() 関数</a></li>
</ul>
<p><a class="reference external" href="http://blog.tekito.org/static/data/2013/09/28/vmware-tools-9.2.3-inode.patch">vmware-tools-9.2.3-inode.patch</a></p>
<div class="highlight"><pre><span class="gd">--- a/inode.c.orig</span>
<span class="gi">+++ b/inode.c</span>
<span class="gu">@@ -1811,14 +1811,13 @@</span>
     */
    if (mask &amp; MAY_ACCESS) { /* For sys_access. */
       struct dentry *dentry;
<span class="gd">-      struct hlist_node *p;</span>
       int dcount = 0;

       if (mask &amp; MAY_NOT_BLOCK)
          return -ECHILD;

       /* Find a dentry with valid d_count. Refer bug 587879. */
<span class="gd">-      hlist_for_each_entry(dentry, p, &amp;inode-&gt;i_dentry, d_alias) {</span>
<span class="gi">+      hlist_for_each_entry(dentry, &amp;inode-&gt;i_dentry, d_alias) {</span>
          dcount = dentry-&gt;d_count;
          if (dcount) {
             LOG(4, (&quot;Found %s %d \n&quot;, dentry-&gt;d_name.name, dcount));
<span class="gd">--- a/shared/compat_mm.h.orig</span>
<span class="gi">+++ b/shared/compat_mm.h</span>
<span class="gu">@@ -90,9 +90,9 @@</span>
 #endif

 /*
<span class="gd">- * In 2.4.10, vmtruncate was changed from returning void to returning int.</span>
<span class="gi">+ * In 3.8.0, vmtruncate was changed from returning void to returning int.</span>
  */
<span class="gd">-#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 4, 10)</span>
<span class="gi">+#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(3, 8, 0)</span>
 #define compat_vmtruncate(inode, size)                                        \
 ({                                                                            \
    int result = 0;                                                            \
<span class="gu">@@ -100,5 +100,12 @@</span>
    result;                                                                    \
 })
 #else
<span class="gd">-#define compat_vmtruncate(inode, size) vmtruncate(inode, size)</span>
<span class="gi">+#define compat_vmtruncate(inode, size)                                        \</span>
<span class="gi">+({                                                                            \</span>
<span class="gi">+   int result = inode_newsize_ok(inode, size);                                \</span>
<span class="gi">+   if (!result) {                                                             \</span>
<span class="gi">+     truncate_setsize(inode, size);                                           \</span>
<span class="gi">+   }                                                                          \</span>
<span class="gi">+   result;                                                                    \</span>
<span class="gi">+})</span>
 #endif
</pre></div>
</li>
<li><p class="first">vmci.c 周りを修正する</p>
<p>file.c と inode.c 周りを修正することでひとまずビルドは通るようになりますが、いざ動かしてみるとシンボルが見つからない旨のエラーが発生してしまいました。</p>
<div class="highlight"><pre>$ sudo insmod vmhgfs.ko
Error: could not insert module vmhgfs.ko: Unknown symbol in module
</pre></div>
<p>dmesg すると以下のようなエラーが出力されていました。</p>
<div class="highlight"><pre>$ dmesg | tail
[42830.843944] vmhgfs: Unknown symbol VMCIDatagram_Send (err 0)
[42830.844015] vmhgfs: Unknown symbol VMCIDatagram_DestroyHnd (err 0)
[42830.844024] vmhgfs: Unknown symbol VMCIDatagram_CreateHnd (err 0)
</pre></div>
<p>いつからかは調べていませんが、どうも VMCI の関数名が変わったようです。ぼくは open-vm-tools を参考に直してしまいました。(最初から open-vm-tools を使えばよかったのかもしれない...。)</p>
<p><a class="reference external" href="http://blog.tekito.org/static/data/2013/09/28/vmware-tools-9.2.3-vmci.patch">vmware-tools-9.2.3-vmci.patch</a></p>
<p>(diff は長いので割愛。)</p>
</li>
</ol>
</div>
<div class="section" id="id4">
<h2>やっと</h2>
<p>これでようやく共有フォルダが見えるようになりました。</p>
<div class="highlight"><pre>$ sudo insmod vmhgfs.ko
$ lsmod | grep vmhgfs
vmhgfs                 52573  0
vmw_vmci               48221  1 vmhgfs
$ sudo mount -t vmhgfs .host:/ /mnt/hgfs/
$ ls /mnt/hgfs/
shared
</pre></div>
</div>

            <section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                                href="http://blog.tekito.org/2013/09/28/linux-3-x-の仮想マシンから-vmware-fusion-の共有フォルダが見えな/#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'blog-tekito-org';
            var disqus_identifier = 'http://blog.tekito.org/2013/09/28/linux-3-x-の仮想マシンから-vmware-fusion-の共有フォルダが見えな/';
        var disqus_url = 'http://blog.tekito.org/2013/09/28/linux-3-x-の仮想マシンから-vmware-fusion-の共有フォルダが見えな/';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
            <aside>
            <hr/>
                                                                                                                                                                        <nav>
            <ul class="articles_timeline">
                                                                     
                <li class="previous_article">« <a href="http://blog.tekito.org/2011/08/20/acpid-を使ってサスペンド/" title="Previous: acpid を使ってサスペンド">acpid を使ってサスペンド</a></li>
                                                                                     
                <li class="next_article"><a href="http://blog.tekito.org/2013/10/14/blogging-with-pelican/" title="Next: Pelican へ移行">Pelican へ移行</a> »</li>
                            </ul>
            </nav>
                                                                                                                                                                                                            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
             
            <h4>Published</h4>
                        <time pubdate="pubdate" datetime="2013-09-28T01:57:00">Sep 28, 2013</time>
                                                <h4>Category</h4>
            <a class="category-link" href="/categories.html#Linux-ref">Linux</a> 
                                    <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                                <li><a href="/tags.html#Debian-ref">Debian
                                        <span>5</span>
                    </a></li>
                            </ul>
            
                    </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
        <footer>
<div id="footer">
    <ul class="footer-content">
                        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>                    <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        
    <script type="text/javascript">
    var disqus_shortname = 'blog-tekito-org';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
            <script  language="javascript" type="text/javascript">
            function uncollapse() {
                var hash_str = window.location.hash;
                if (window.location.hash.match(/^#comment-\d+$/))
                {
                    var hash_str = '#disqus_thread';
                }
                $(hash_str).collapse({
                    toggle: true
                    })
            }
        </script>

        <script type="text/javascript" language="JavaScript">
            uncollapse(); 
        </script>
        </body>
</html>