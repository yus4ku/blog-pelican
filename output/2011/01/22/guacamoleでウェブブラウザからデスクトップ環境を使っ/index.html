<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="author" content="Yusaku" />
        <meta name="copyright" content="Yusaku" />
        
                <meta name="keywords" content="Debian, Linux, Computing, " />
        <title>Guacamoleでウェブブラウザからデスクトップ環境を使ってみた  · いままでのこと
</title>
                <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://blog.tekito.org/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://blog.tekito.org/theme/css/solarizedlight.css" media="screen">
                <link rel="shortcut icon" href="http://blog.tekito.org/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://blog.tekito.org/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://blog.tekito.org/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://blog.tekito.org/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://blog.tekito.org/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://blog.tekito.org/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://blog.tekito.org/theme/images/apple-touch-icon-144x144.png" />
                <link href="http://blog.tekito.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="いままでのこと - Full Atom Feed" />
            <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12673985-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://blog.tekito.org/"><span class=site-name>いままでのこと</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://blog.tekito.org">Home</a></li>
                                                                                    <li ><a href="http://blog.tekito.org/pages/about.html">About</a></li>
                                                                                    <li ><a href="http://blog.tekito.org/categories.html">Categories</a></li>
                            <li ><a href="http://blog.tekito.org/tags.html">Tags</a></li>
                            <li ><a href="http://blog.tekito.org/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://blog.tekito.org/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
                    <article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/"> Guacamoleでウェブブラウザからデスクトップ環境を使ってみた  </a></h1>
    </header>
</div>

<div class="row-fluid">
            <div class="span8 offset2 article-content">
            
            <p><a class="reference external" href="http://guacamole.sourceforge.net/">Guacamole</a> はHTML5とAjaxで実現されたVNCクライアントです。</p>
<p>ウェブブラウザさえあれば、どこからでもアクセスできるし便利そうなので試してみました。</p>
<a class="reference external image-reference" href="http://blog.tekito.org/static/data/2011/01/22/guacamole.jpg"><img alt="Guacamole" src="http://blog.tekito.org/static/data/2011/01/22/guacamole.jpg" style="width: 500px;" /></a>
<p>(Guacamoleを使ってノートPCからデスクトップPCにつないでみた様子。Chromeの中でChromeを立ち上げてしまうセンスの無さ...。)</p>
<p>実際にGuacamoleを使ってグリグリ動かしている動画が <a class="reference external" href="http://guacamole.sourceforge.net/">公式サイト</a> にもあるので、そちらも参照のこと。</p>
<p>Guacamoleは日本語だと「ガカモレ」とか「ワカモレ」と発音するようです。</p>
<p>基本的に <a class="reference external" href="http://guacamole.sourceforge.net/">公式サイト</a> に載ってるインストール手順通りでハマるところはありませんでしたが、ググっても日本語記事が少ないようなのでメモ。</p>
<div class="section" id="id3">
<h2>はじめに</h2>
<p>Guacamoleを利用するためには <em>vncserver</em>, <em>apache</em>, <em>tomcat</em> のほか <em>デスクトップ環境</em> が必要です。デスクトップ環境の構築方法については触れないので、その辺りが分からない方はググってください。</p>
<p>また、この記事はとりあえず実験的に動かすことを目的にしているので、継続して利用するのであれば設定を見直す必要があります。</p>
</div>
<div class="section" id="id4">
<h2>インストール手順</h2>
<p>まずは必要なパッケージをインストールする。(debian squeezeの場合)</p>
<div class="highlight"><pre>$ sudo apt-get install vnc4server apache2 tomcat6
</pre></div>
<ol class="arabic">
<li><p class="first">Apache Tomcat</p>
<p>Apacheとtomcatはインストール直後に既に実行されていたが、一応確認。</p>
<div class="highlight"><pre>$ /etc/init.d/apache2 status
Apache2 is running (pid 1250).
$ /etc/init.d/tomcat6 status
Tomcat servlet engine is running with pid 2601.
</pre></div>
<p>netstatすると8080番でjava(tomcat)がLISTENしているので、アクセスしてみる。</p>
<div class="highlight"><pre>$ curl http://localhost:8080/
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
   &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Apache Tomcat&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;It works !&lt;/h1&gt;
...
</pre></div>
<p>ぶじに実行できている。</p>
</li>
<li><p class="first">VNCサーバ</p>
<p>VNCサーバを起動する。</p>
<div class="highlight"><pre>$ vncserver
</pre></div>
<p>初回起動時にはパスワードを問われるので、適当に設定。このパスワードはGuacamoleの設定でも使用します。</p>
<div class="highlight"><pre>You will require a password to access your desktops.

Password: [password]
Verify: [password]
</pre></div>
<p>vncserverは起動時のオプションで解像度や色数も変えられます。使いづらかったらその辺りをいじってみましょう。</p>
</li>
<li><p class="first">Guacamole</p>
<p>ここまできたら、いよいよGuacamoleのダウンロードと設定です。ダウンロードは <a class="reference external" href="http://sourceforge.net/projects/guacamole/files/">このへん</a> からお好きなものを。</p>
<p>ぼくは guacamole-0.3.0rc1.tar.gz(最新版:2011/1/21時点) をつかいました。</p>
<p>ダウンロードしたら解凍して中身を見てみる。</p>
<div class="highlight"><pre>$ tar xf guacamole-0.3.0rc1.tar.gz
$ ls guacamole-0.3.0rc1
LICENSE.txt  guacamole-src.tar  guacamole-users.xml  guacamole.war  guacamole.xml
</pre></div>
<p>この中で使うのは <em>guacamole-users.xml</em>, <em>guacamole.war</em>, <em>guacamole.xml</em> の3ファイルです。</p>
<p>3.1. guacamole.war</p>
<p>まずは <em>guacamole.war</em> を任意の場所に設置します。</p>
<p>設置場所のパスは <em>guacamole.xml</em> で指定することになりますが、ここでは <em>guacamole.xml</em> の初期設定で指定されている /var/lib/guacamole/guacamole.war に置くことにします。</p>
<div class="highlight"><pre>$ sudo mkdir -p /var/lib/guacamole
$ sudo cp guacamole.war /var/lib/guacamole/
</pre></div>
<p>3.2 guacamole-users.xml</p>
<p>つぎに <em>guacamole-users.xml</em> を /var/lib/tomcat6/conf/ にコピーして設定を編集します。</p>
<p>このファイルにはBASIC認証でのアクセス時に使用するユーザーとパスワードの設定を行います。</p>
<div class="highlight"><pre>$ sudo cp guacamole-users.xml /var/lib/tomcat6/conf/
$ sudo nano -wk /var/lib/tomcat6/conf/guacamole-users.xml
</pre></div>
<p>5行目の username=&quot;&quot;, password=&quot;&quot; を適当に設定しましょう。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39;?&gt;</span>

<span class="nt">&lt;tomcat-users&gt;</span>
  <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">&quot;guacamole&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">&quot;guacamole&quot;</span> <span class="na">password=</span><span class="s">&quot;changeme&quot;</span> <span class="na">roles=</span><span class="s">&quot;guacamole&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tomcat-users&gt;</span>
</pre></div>
</td></tr></table><p>3.3 guacamole.xml</p>
<p>さいごに <em>guacamole.xml</em> をTomcatの ./conf/Catalina/HOSTNAME/ 以下に設置します。</p>
<p>HOSTNAME は実行するホストに応じて決める。ぼくはとりあえず動作確認のため localhost に置きました。</p>
<div class="highlight"><pre>$ sudo cp guacamole.xml /var/lib/tomcat6/conf/Catalina/localhost/
</pre></div>
<p><em>guacamole.xml</em> の編集の前に、VNCサーバが待ち受けてるポート番号を調べます。</p>
<div class="highlight"><pre>$ sudo netstat -anp --tcp
稼働中のインターネット接続 (サーバと確立)
Proto 受信-Q 送信-Q 内部アドレス            外部アドレス            状態        PID/Program name
tcp        0      0 0.0.0.0:6001            0.0.0.0:*               LISTEN      4752/Xvnc4
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1405/sshd
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1619/exim4
tcp6       0      0 :::8080                 :::*                    LISTEN      4825/java
tcp6       0      0 :::80                   :::*                    LISTEN      1250/apache2
tcp6       0      0 :::22                   :::*                    LISTEN      1405/sshd
tcp6       0      0 ::1:25                  :::*                    LISTEN      1619/exim4
tcp6       0      0 127.0.0.1:8005          :::*                    LISTEN      4825/java
tcp6       0      0 :::5901                 :::*                    LISTEN      4752/Xvnc4
...
</pre></div>
<p>Xvnc4ってのがVNCサーバ。</p>
<p>tcpとtcp6の両方で待ち受けていることがわかりますが、javaの待ち受けがtcp6の8080番なので、VNCサーバもそれに合わせてtcp6のほう(5901番)を使います。</p>
<p>VNCサーバのポート番号はわかったので <em>guacamole.xml</em> を編集しましょう。</p>
<div class="highlight"><pre>$ sudo nano -wk /var/lib/tomcat6/conf/Catalina/localhost/guacamole.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;!--
    Guacamole - Pure JavaScript/HTML VNC Client
    Copyright (C) 2010  Michael Jumper

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
--&gt;

&lt;Context antiJARLocking=&quot;true&quot; path=&quot;/guacamole&quot; docBase=&quot;/var/lib/guacamole/guacamole.war&quot;&gt;

    &lt;!-- Change the lines below to match your VNC server --&gt;
    &lt;Parameter name=&quot;host&quot; value=&quot;localhost&quot;/&gt;
    &lt;Parameter name=&quot;port&quot; value=&quot;5900&quot;/&gt;

    &lt;!-- Password (VNC Authentication)

         Uncomment and change the line below if your VNC server is
         password protected. --&gt;

    &lt;!--
    &lt;Parameter name=&quot;password&quot; value=&quot;PASSWORD&quot;/&gt;
    --&gt;
</pre></div>
<p>name=&quot;host&quot;, name=&quot;port&quot;, name=&quot;password&quot; の value を編集。</p>
<p>passwordにはvncserver起動時に設定したパスワードを設定する。パスワードの設定は <em>コメントアウトされている</em> ので解除する必要があります。そこだけ注意。</p>
</li>
</ol>
</div>
<div class="section" id="id6">
<h2>これで設定は完了！</h2>
<p>あとはTomcatを再起動してから <a class="reference external" href="http://localhost:8080/guacamole">http://localhost:8080/guacamole</a> へアクセスすればおっけー。</p>
<div class="highlight"><pre>$ sudo /etc/init.d/tomcat6 restart
Stopping Tomcat servlet engine: tomcat6.
Starting Tomcat servlet engine: tomcat6.
</pre></div>
</div>
<div class="section" id="id7">
<h2>使ってみた感想</h2>
<p>レスポンスもなかなかいいし、設定も簡単なのでとっつきやすいです。あと、ブラウザにデスクトップが表示されるのはちょっと感動する。</p>
<p>操作性はデスクトップ環境にもよると思いますが、タイル型のWMとの相性はかなり悪め。この辺りは設定次第なのかもしれません。</p>
<p>重たい処理もやってみようと思い、ためしに Neverwinter Nights(PCゲーム) を動かしてみた。PCが非力なのもあってか、カックカクでゲームってレベルじゃない。色もおかしいし。</p>
<a class="reference external image-reference" href="http://blog.tekito.org/static/data/2011/01/22/nwn.jpg"><img alt="Neverwinter Nights" src="http://blog.tekito.org/static/data/2011/01/22/nwn.jpg" style="width: 500px;" /></a>
<p>でも、ブラウザ内で3DのPCゲームが動くってすごいね。</p>
<p>Wineも使ってあれこれやってみたけど、そっちはうまくいかなかったのでまた今度挑戦しよう。</p>
<p>それにしてもGuacamoleって覚えづらい名前だ...。ブラウザから見に行く時に「<a class="reference external" href="http://localhost:8080/gua">http://localhost:8080/gua</a>... gua... えーと、なんだっけ？」ってことが何度もあった。</p>
</div>

            <section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                                href="http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'blog-tekito-org';
            var disqus_identifier = 'http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/';
        var disqus_url = 'http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
            <aside>
            <hr/>
                                                                                                                                                                                                                                                <nav>
            <ul class="articles_timeline">
                                                                     
                <li class="previous_article">« <a href="http://blog.tekito.org/2010/11/23/bash-のビルトインコマンド-local-について/" title="Previous: bash のビルトインコマンド “local” について">bash のビルトインコマンド “local” について</a></li>
                                                                                     
                <li class="next_article"><a href="http://blog.tekito.org/2011/08/20/acpid-を使ってサスペンド/" title="Next: acpid を使ってサスペンド">acpid を使ってサスペンド</a> »</li>
                            </ul>
            </nav>
                                                                                                                                                            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
             
            <h4>Published</h4>
                        <time pubdate="pubdate" datetime="2011-01-22T04:26:00">Jan 22, 2011</time>
                                                <h4>Category</h4>
            <a class="category-link" href="/categories.html#Computing-ref">Computing</a> 
                                    <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                                <li><a href="/tags.html#Debian-ref">Debian
                                        <span>5</span>
                    </a></li>
                                <li><a href="/tags.html#Linux-ref">Linux
                                        <span>7</span>
                    </a></li>
                            </ul>
            
            <h4>Share</h4>
            <!-- Twitter button -->
            <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
            <!-- Hatena button -->
            <a href="http://b.hatena.ne.jp/entry/http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/" class="hatena-bookmark-button"
               data-hatena-bookmark-title="Guacamoleでウェブブラウザからデスクトップ環境を使ってみた" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja"
               title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png"
               alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;"/></a>
            <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
            <!-- Facebook button -->
            <div id="fb-root"></div>
            <script>(function(d, s, id) {
              var js, fjs = d.getElementsByTagName(s)[0];
              if (d.getElementById(id)) return;
              js = d.createElement(s); js.id = id;
              js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
              fjs.parentNode.insertBefore(js, fjs);
              }(document, 'script', 'facebook-jssdk'));</script>
            <div class="fb-share-button" data-href="http://blog.tekito.org/2011/01/22/guacamoleでウェブブラウザからデスクトップ環境を使っ/" data-type="button_count"></div>

                    </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
        <footer>
<div id="footer">
    <ul class="footer-content">
                        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>                    <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        
    <script type="text/javascript">
    var disqus_shortname = 'blog-tekito-org';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
            <script  language="javascript" type="text/javascript">
            function uncollapse() {
                var hash_str = window.location.hash;
                if (window.location.hash.match(/^#comment-\d+$/))
                {
                    var hash_str = '#disqus_thread';
                }
                $(hash_str).collapse({
                    toggle: true
                    })
            }
        </script>

        <script type="text/javascript" language="JavaScript">
            uncollapse(); 
        </script>
        </body>
</html>